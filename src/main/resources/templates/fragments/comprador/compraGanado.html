<div xmlns:th="http://www.thymeleaf.org" class="space-y-6">
    <div th:fragment="detalle">

        <!-- PASO 2: CONFIRMACIÓN DE NEGOCIACIÓN FINAL   -->
        <div th:if="${!venta.pendienteConfirmacion and venta.pasoActual == 2}">
            <div class="bg-white rounded-2xl shadow-lg p-8">

                <!-- ENCABEZADO -->
                <div class="flex items-center gap-3 mb-4">
                    <div class="loading-spinner"></div>
                    <h3 class="text-2xl font-bold text-gray-900">
                        Paso 2: El vendedor está definiendo los términos finales
                    </h3>
                </div>

                <p class="text-gray-700 mb-6 leading-relaxed">
                    El vendedor está registrando los <span class="font-semibold">términos finales de la negociación</span>
                    acordados en la cita. En cuanto termine, podrás revisarlos y confirmar tu decisión.
                </p>

                <!-- BARRA DE PROGRESO -->
                <div class="progress-bar mb-8"></div>

                <!-- QUE ESTÁ HACIENDO EL VENDEDOR -->
                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-edit text-blue-700 text-xl'></i>
                        </div>
                        <div>
                            <p class="font-semibold text-blue-900">¿Qué está haciendo el vendedor?</p>
                            <p class="text-sm text-blue-800 mt-1">
                                Está ingresando los precios, cantidades y condiciones finales que acordaron durante la cita.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- MENSAJE DE ESPERA -->
                <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-yellow-200 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-time-five text-yellow-600 text-xl'></i>
                        </div>
                        <div>
                            <p class="font-semibold text-yellow-900">Debes esperar un momento</p>
                            <p class="text-sm text-yellow-800 mt-1">
                                Este proceso puede tomar unos minutos. La página se actualizará automáticamente
                                cuando el vendedor termine.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- INFORMACIÓN IMPORTANTE -->
                <div class="bg-green-50 border-2 border-green-300 rounded-xl p-6">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-info-circle text-green-600 text-xl'></i>
                        </div>
                        <div>
                            <p class="font-semibold text-green-900">Información importante</p>
                            <p class="text-sm text-green-800 mt-1 leading-relaxed">
                                Si el proceso avanza directamente al <strong>Paso 3</strong> sin requerir tu confirmación,
                                significa que el vendedor <strong>mantendrá los mismos términos de la publicación original</strong>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${tipoProducto == 'GANADO' && venta.pasoActual == 2 && venta.pendienteConfirmacion}" class="bg-white rounded-2xl shadow-lg p-8">
            <h3 class="text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                <i class='bx bx-handshake text-emerald-600'></i>
                Paso 2: Confirmación de Negociación Final
            </h3>
            <p class="text-gray-600 mb-6">El vendedor ha establecido los términos finales de la negociación</p>

            <div th:if="${venta.pendienteConfirmacion == true}" class="bg-orange-50 border-2 border-orange-300 rounded-xl p-6 mb-6">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-orange-200 rounded-lg flex items-center justify-center flex-shrink-0">
                        <i class='bx bx-info-circle text-2xl text-orange-600'></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-bold text-orange-900 text-lg">Cambios en la Oferta</p>
                        <p class="text-sm text-orange-800 mt-2">El vendedor ha realizado cambios en los términos de la negociación después de la cita. Revisa los cambios detallados abajo.</p>
                    </div>
                </div>
            </div>

            <!-- Comparativa de cambios si existen -->
            <div th:if="${venta.pendienteConfirmacion == true}" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">

                <!-- Precio -->
                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <p class="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                        <i class='bx bx-dollar-circle text-orange-600'></i>
                        Precio Total
                    </p>
                    <div class="space-y-2">
                        <div>
                            <p class="text-xs text-gray-600">Oferta Original:</p>
                            <p class="text-lg font-bold text-gray-900 line-through text-gray-400" th:text="${'$' + #numbers.formatInteger(venta.producto.precioProducto, 1, 'DEFAULT')}">$500,000</p>
                        </div>
                        <div class="h-1 bg-gradient-to-r from-transparent via-orange-300 to-transparent"></div>
                        <div>
                            <p class="text-xs text-gray-600">Nueva Oferta:</p>
                            <p class="text-lg font-bold text-orange-600" th:text="${'$' + #numbers.formatInteger(ventaDetalle.precioNegociado, 1, 'DEFAULT')}">$480,000</p>
                        </div>
                    </div>
                </div>

                <!-- Cantidad -->
                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <p class="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                        <i class='bx bx-shopping-bag text-orange-600'></i>
                        Cantidad de Animales
                    </p>
                    <div class="space-y-2">
                        <div>
                            <p class="text-xs text-gray-600">Oferta Original:</p>
                            <p class="text-lg font-bold text-gray-900 line-through text-gray-400" th:text="${venta.producto.cantidad + ' animales'}">10 animales</p>
                        </div>
                        <div class="h-1 bg-gradient-to-r from-transparent via-orange-300 to-transparent"></div>
                        <div>
                            <p class="text-xs text-gray-600">Nueva Oferta:</p>
                            <p class="text-lg font-bold text-orange-600" th:text="${ventaDetalle.cantidadNegociada + ' animales'}">9 animales</p>
                        </div>
                    </div>
                </div>

                <!-- Condiciones Especiales -->
                <div th:if="${ventaDetalle.observacionesSanitarias != null and !#strings.isEmpty(ventaDetalle.observacionesSanitarias)}" class="border-2 border-gray-200 rounded-xl p-4 md:col-span-2">
                    <p class="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                        <i class='bx bx-list-check text-orange-600'></i>
                        Observaciones Sanitarias
                    </p>
                    <div class="space-y-2 text-sm">
                        <div th:if="${ventaDetalle.observacionesSanitarias != null and !#strings.isEmpty(ventaDetalle.observacionesSanitarias)}">
                            <p class="text-orange-600 font-semibold" th:text="${ventaDetalle.observacionesSanitarias}">Entrega a 5 días</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen de totales -->
            <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                <p class="font-bold text-blue-900 mb-4 flex items-center gap-2">
                    <i class='bx bx-calculator'></i>
                    Resumen de la Negociación
                </p>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                    <div class="bg-white p-3 rounded border border-blue-200">
                        <p class="text-xs text-gray-600 font-semibold">Cantidad</p>
                        <p class="text-lg font-bold text-gray-900" th:text="${ventaDetalle.cantidadNegociada}"></p>
                    </div>

                    <div class="bg-white p-3 rounded border border-blue-200">
                        <p class="text-xs text-gray-600 font-semibold">Total</p>
                        <p class="text-lg font-bold text-emerald-600" th:text="${'$' + #numbers.formatInteger(ventaDetalle.precioNegociado, 1, 'DEFAULT')}">$4,320,000</p>
                    </div>
                </div>
            </div>

            <!-- Formulario de respuesta -->
            <form th:action="@{/comprador/compras/confirmar-negociacion}" method="post" class="space-y-6">
                <input type="hidden" name="idVenta" th:value="${venta.idVenta}">
                <input type="hidden" name="cantidad" th:value="${ventaDetalle.cantidadNegociada}">
                <input type="hidden" name="precio" th:value="${ventaDetalle.precioNegociado}">

                <div class="bg-white border-2 rounded-xl p-6">
                    <p class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class='bx bx-help-circle'></i>
                        ¿Estás de acuerdo con estos términos?
                    </p>

                    <div class="space-y-3 mb-6">
                        <label class="flex items-center gap-3 cursor-pointer p-3 border-2 border-gray-200 rounded-lg hover:border-emerald-400 hover:bg-emerald-50 transition">
                            <input type="radio" name="respuesta" value="ACEPTA" required class="w-5 h-5 accent-emerald-600">
                            <span class="flex-1">
                                <span class="font-semibold text-gray-900">Sí, acepto estos términos</span>
                                <p class="text-xs text-gray-600 mt-0.5">Proceder con la compra en estas condiciones</p>
                            </span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer p-3 border-2 border-gray-200 rounded-lg hover:border-orange-400 hover:bg-orange-50 transition">
                            <input type="radio" name="respuesta" value="RECHAZA" required class="w-5 h-5 accent-orange-600">
                            <span class="flex-1">
                                <span class="font-semibold text-gray-900">No estoy de acuerdo</span>
                                <p class="text-xs text-gray-600 mt-0.5">Enviar razón del rechazo al vendedor</p>
                            </span>
                        </label>
                    </div>

                    <!-- Campo para razón si rechaza (mostrado dinámicamente con JS) -->
                    <div id="razonRechazoContainer" class="hidden mt-4 p-4 bg-orange-50 border-2 border-orange-300 rounded-lg">
                        <label class="block text-sm font-bold text-gray-900 mb-2 flex items-center gap-2">
                            <i class='bx bx-message-square-detail'></i>
                            Razón del Rechazo *
                        </label>
                        <textarea name="razonRechazo" rows="4" placeholder="Explica por qué no aceptas estos términos. Sé específico para facilitar la negociación..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-orange-600 focus:ring-2 focus:ring-orange-200 transition" id="razonRechazoInput"></textarea>
                        <p class="text-xs text-orange-700 mt-2">Mínimo 10 caracteres</p>
                    </div>
                </div>

                <!-- Aviso legal -->
                <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-lg">
                    <p class="font-bold text-blue-900 mb-2 flex items-center gap-2">
                        <i class='bx bx-shield-alt'></i>
                        Importante
                    </p>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li class="flex items-start gap-2"><i class='bx bx-check text-blue-600 flex-shrink-0 mt-0.5'></i> <span>Al aceptar, confirmas que estás de acuerdo con todos los términos de la negociación</span></li>
                        <li class="flex items-start gap-2"><i class='bx bx-check text-blue-600 flex-shrink-0 mt-0.5'></i> <span>Si rechazas, la negociación volverá a fase de revisión por el vendedor</span></li>
                    </ul>
                </div>

                <div class="flex gap-4">
                    <button type="button" onclick="history.back()" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                        <i class='bx bx-arrow-back'></i> Atrás
                    </button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white rounded-lg font-semibold hover:shadow-lg transition flex-1 flex items-center justify-center gap-2">
                        <i class='bx bx-check-circle'></i> Confirmar Decisión
                    </button>
                </div>
            </form>

            <script>
                // Mostrar/ocultar razón de rechazo dinámicamente
                document.querySelectorAll('input[name="respuesta"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        const container = document.getElementById('razonRechazoContainer');
                        const input = document.getElementById('razonRechazoInput');
                        if (this.value === 'RECHAZA') {
                            container.classList.remove('hidden');
                            input.required = true;
                        } else {
                            container.classList.add('hidden');
                            input.required = false;
                            input.value = '';
                        }
                    });
                });
            </script>
        </div>

        <!-- ============================================ -->
        <!-- PASO 3: DOCUMENTACIÓN SANITARIA DE GANADO   -->
        <!-- ============================================ -->
        <div th:if="${tipoProducto == 'GANADO' && venta.pasoActual == 3}" class="bg-white rounded-2xl shadow-lg p-8">
            <h3 class="text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                <i class='bx bx-shield-check text-emerald-600'></i>
                Paso 3: Documentación Sanitaria y Trazabilidad
            </h3>
            <p class="text-gray-600 mb-6">Revisa toda la documentación obligatoria y opcional proporcionada por el vendedor</p>

            <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class='bx bx-check-shield text-2xl text-blue-700'></i>
                    </div>
                    <div>
                        <p class="font-bold text-blue-900 text-lg mb-2">Garantía de Calidad Sanitaria</p>
                        <p class="text-sm text-blue-800 leading-relaxed">
                            Todos los documentos obligatorios han sido verificados y cumplen con los requisitos legales del ICA.
                        </p>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN: DOCUMENTOS OBLIGATORIOS -->
            <div class="mb-8">
                <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class='bx bx-error text-red-600'></i>
                    Documentos Obligatorios
                </h4>
                <div class="space-y-4">

                    <!-- GSMI -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-emerald-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-file text-2xl text-emerald-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">GSMI - Guía Sanitaria de Movilización Interna</p>
                                    <p class="text-sm text-gray-600 mb-2">Documento ICA que autoriza el transporte legal del ganado</p>
                                    <p class="text-xs text-gray-500">Contiene: número de animales, destino, fecha de movilización y vigencia</p>

                                    <div th:if="${comprobantes['GSMI'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['GSMI'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['GSMI'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-50 text-emerald-700 rounded-lg hover:bg-emerald-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Documento
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['GSMI'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Verificado
                    </span>
                            <span th:unless="${comprobantes['GSMI'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-orange-100 text-orange-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-time'></i> Pendiente
                    </span>
                        </div>
                    </div>

                    <!-- Certificados Sanitarios -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-emerald-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-shield-plus text-2xl text-emerald-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Certificados Sanitarios y Vacunación</p>
                                    <p class="text-sm text-gray-600 mb-2">Libreta de salud con vacunas actualizadas</p>
                                    <p class="text-xs text-gray-500">Incluye: Fiebre Aftosa, Brucelosis, último ciclo certificado por ICA</p>

                                    <div th:if="${comprobantes['CERTIFICADO_SANITARIO'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['CERTIFICADO_SANITARIO'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['CERTIFICADO_SANITARIO'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-50 text-emerald-700 rounded-lg hover:bg-emerald-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Certificados
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['CERTIFICADO_SANITARIO'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Verificado
                    </span>
                            <span th:unless="${comprobantes['CERTIFICADO_SANITARIO'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-orange-100 text-orange-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-time'></i> Pendiente
                    </span>
                        </div>
                    </div>

                    <!-- Factura Propiedad -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-emerald-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-receipt text-2xl text-emerald-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Factura o Documento de Propiedad</p>
                                    <p class="text-sm text-gray-600 mb-2">Prueba de propiedad legal del vendedor</p>
                                    <p class="text-xs text-gray-500">Factura de compra, contrato de transferencia o declaración firmada</p>

                                    <div th:if="${comprobantes['FACTURA_PROPIEDAD'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['FACTURA_PROPIEDAD'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['FACTURA_PROPIEDAD'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-50 text-emerald-700 rounded-lg hover:bg-emerald-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Factura
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['FACTURA_PROPIEDAD'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Verificado
                    </span>
                            <span th:unless="${comprobantes['FACTURA_PROPIEDAD'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-orange-100 text-orange-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-time'></i> Pendiente
                    </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN: DOCUMENTOS OPCIONALES -->
            <div class="mb-8">
                <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class='bx bx-check-shield text-emerald-600'></i>
                    Documentos Opcionales (Valor Agregado)
                </h4>
                <div class="space-y-4">

                    <!-- Inventario -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-blue-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-list-ul text-2xl text-blue-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Inventario Individual del Lote</p>
                                    <p class="text-sm text-gray-600 mb-2">Listado detallado con identificación de cada animal</p>
                                    <p class="text-xs text-gray-500">ID, marcas, edad, peso, características físicas</p>

                                    <div th:if="${comprobantes['INVENTARIO_LOTE'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['INVENTARIO_LOTE'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['INVENTARIO_LOTE'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Inventario
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['INVENTARIO_LOTE'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Incluido
                    </span>
                            <span th:unless="${comprobantes['INVENTARIO_LOTE'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-minus-circle'></i> No Incluido
                    </span>
                        </div>
                    </div>

                    <!-- SINIGAN -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-blue-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-barcode text-2xl text-blue-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Certificados SINIGAN (Registro Individual)</p>
                                    <p class="text-sm text-gray-600 mb-2">Número individual en el Sistema Nacional de Identificación</p>
                                    <p class="text-xs text-gray-500">Evita ventas duplicadas y confirma autenticidad</p>

                                    <div th:if="${comprobantes['CERTIFICADO_SINIGAN'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['CERTIFICADO_SINIGAN'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['CERTIFICADO_SINIGAN'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar SINIGAN
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['CERTIFICADO_SINIGAN'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Incluido
                    </span>
                            <span th:unless="${comprobantes['CERTIFICADO_SINIGAN'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-minus-circle'></i> No Incluido
                    </span>
                        </div>
                    </div>

                    <!-- Hierro -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-blue-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-customize text-2xl text-blue-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Certificado de Hierro o Marca Registrada</p>
                                    <p class="text-sm text-gray-600 mb-2">Certificación de marca registrada del predio</p>
                                    <p class="text-xs text-gray-500">Verifica que el ganado pertenece al hierro registrado</p>

                                    <div th:if="${comprobantes['CERTIFICADO_HIERRO'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['CERTIFICADO_HIERRO'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['CERTIFICADO_HIERRO'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Certificado
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['CERTIFICADO_HIERRO'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Incluido
                    </span>
                            <span th:unless="${comprobantes['CERTIFICADO_HIERRO'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-minus-circle'></i> No Incluido
                    </span>
                        </div>
                    </div>

                    <!-- Pesaje -->
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 hover:border-blue-400 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-start gap-4 flex-1">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class='bx bx-trending-up text-2xl text-blue-600'></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-900 text-base mb-1">Certificado de Pesaje Reciente</p>
                                    <p class="text-sm text-gray-600 mb-2">Documento de pesaje oficial actualizado</p>
                                    <p class="text-xs text-gray-500">Transparencia sobre el peso real verificado</p>

                                    <div th:if="${comprobantes['CERTIFICADO_PESAJE'] != null}">
                                        <p class="text-xs text-gray-500 mb-2 mt-3">
                                            Subido: <span th:text="${#temporals.format(comprobantes['CERTIFICADO_PESAJE'].fechaSubida, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                                        </p>
                                        <a th:href="@{'/documentos/' + ${comprobantes['CERTIFICADO_PESAJE'].rutaArchivo}}" target="_blank"
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-sm font-semibold">
                                            <i class='bx bx-download'></i>
                                            Descargar Pesaje
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span th:if="${comprobantes['CERTIFICADO_PESAJE'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-check-circle'></i> Incluido
                    </span>
                            <span th:unless="${comprobantes['CERTIFICADO_PESAJE'] != null}" class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-sm font-bold whitespace-nowrap">
                        <i class='bx bx-minus-circle'></i> No Incluido
                    </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Observaciones -->
            <div th:if="${ventaDetalle.observacionesSanitarias != null and !#strings.isEmpty(ventaDetalle.observacionesSanitarias)}"
                 class="bg-amber-50 border-l-4 border-amber-500 p-6 rounded-lg mb-6">
                <p class="font-bold text-amber-900 mb-2 flex items-center gap-2">
                    <i class='bx bx-note'></i>
                    Observaciones Sanitarias del Vendedor
                </p>
                <p class="text-sm text-amber-800 leading-relaxed" th:text="${ventaDetalle.observacionesSanitarias}">Información adicional</p>
            </div>

            <!-- Resumen -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-300 rounded-xl p-6">
                <p class="font-bold text-green-900 mb-4 flex items-center gap-2 text-lg">
                    <i class='bx bx-check-double text-2xl'></i>
                    Resumen de Cumplimiento Normativo
                </p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg p-4 text-center border-2 border-green-200 shadow-sm">
                        <p class="text-3xl font-bold text-green-600 mb-1">
                            <span th:if="${comprobantes['GSMI'] != null && comprobantes['CERTIFICADO_SANITARIO'] != null && comprobantes['FACTURA_PROPIEDAD'] != null}">✓</span>
                            <span th:unless="${comprobantes['GSMI'] != null && comprobantes['CERTIFICADO_SANITARIO'] != null && comprobantes['FACTURA_PROPIEDAD'] != null}">—</span>
                        </p>
                        <p class="text-xs text-gray-600 font-semibold">Docs Obligatorios</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 text-center border-2 border-green-200 shadow-sm">
                        <p class="text-lg font-bold text-gray-900 mb-1">ICA</p>
                        <p class="text-xs text-gray-600 font-semibold">Normativa</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 text-center border-2 border-green-200 shadow-sm">
                        <p class="text-lg font-bold text-gray-900 mb-1">Legal</p>
                        <p class="text-xs text-gray-600 font-semibold">Trazabilidad</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 text-center border-2 border-green-200 shadow-sm">
                        <p class="text-lg font-bold text-gray-900 mb-1">100%</p>
                        <p class="text-xs text-gray-600 font-semibold">Transparencia</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- PASO 5: TRANSPORTE Y ENTREGA - COMPRADOR    -->
        <!-- ============================================ -->
        <div th:if="${tipoProducto == 'GANADO' && venta.pasoActual == 5}" class="bg-white rounded-2xl shadow-lg p-8">
            <h3 class="text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                <i class='bx bx-truck text-emerald-600'></i>
                Paso 5: Transporte y Entrega del Ganado
            </h3>
            <p class="text-gray-600 mb-6">Programa y gestiona el transporte del ganado desde el predio del vendedor hasta tu ubicación</p>

            <!-- Alertas -->
            <div th:if="${success}" class="bg-emerald-50 border-2 border-emerald-300 rounded-xl p-4 mb-6">
                <div class="flex items-center gap-3">
                    <i class='bx bx-check-circle text-2xl text-emerald-600'></i>
                    <p class="text-emerald-800 font-semibold" th:text="${success}"></p>
                </div>
            </div>

            <div th:if="${error}" class="bg-red-50 border-2 border-red-300 rounded-xl p-4 mb-6">
                <div class="flex items-center gap-3">
                    <i class='bx bx-error text-2xl text-red-600'></i>
                    <p class="text-red-800 font-semibold" th:text="${error}"></p>
                </div>
            </div>

            <!-- CASO 1: Transporte NO programado aún -->
            <div th:if="${transporte == null}">
                <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-info-circle text-2xl text-blue-700'></i>
                        </div>
                        <div>
                            <p class="font-bold text-blue-900 text-lg mb-2">Programa el Transporte</p>
                            <p class="text-sm text-blue-800 leading-relaxed">
                                Como comprador, eres responsable de coordinar el transporte del ganado. Completa la información del transportista
                                y el vendedor será notificado para preparar la entrega en la fecha programada.
                            </p>
                        </div>
                    </div>
                </div>

                <form th:action="@{/comprador/compras/programar-transporte}" method="post" class="space-y-6">
                    <input type="hidden" name="idVenta" th:value="${venta.idVenta}">

                    <!-- Información del Transporte -->
                    <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class='bx bx-calendar-event text-emerald-600'></i>
                            Programación del Transporte
                        </h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-calendar text-emerald-600'></i> Fecha de Transporte *
                                </label>
                                <input type="date" name="fechaTransporte" required
                                       th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition">
                                <p class="text-xs text-gray-500 mt-1">Fecha en que se recogerá el ganado</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-time text-emerald-600'></i> Hora Estimada *
                                </label>
                                <input type="time" name="horaTransporte" required
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition">
                                <p class="text-xs text-gray-500 mt-1">Hora aproximada de recogida</p>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-building text-emerald-600'></i> Empresa Transportadora *
                                </label>
                                <input type="text" name="empresaTransporte" required
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition"
                                       placeholder="Ej: Transportes Ganaderos del Valle S.A.S.">
                            </div>
                        </div>
                    </div>

                    <!-- Información del Vehículo y Conductor -->
                    <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class='bx bx-car text-emerald-600'></i>
                            Datos del Vehículo y Conductor
                        </h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-id-card text-emerald-600'></i> Placa del Vehículo *
                                </label>
                                <input type="text" name="placaVehiculo" required maxlength="7"
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition uppercase"
                                       placeholder="ABC123">
                                <p class="text-xs text-gray-500 mt-1">Vehículo registrado ante el ICA</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-user text-emerald-600'></i> Nombre del Conductor *
                                </label>
                                <input type="text" name="nombreConductor" required
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition"
                                       placeholder="Juan Pérez García">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-phone text-emerald-600'></i> Teléfono del Conductor *
                                </label>
                                <input type="tel" name="telefonoConductor" required
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition"
                                       placeholder="+57 300 123 4567">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class='bx bx-id-card text-emerald-600'></i> Cédula del Conductor *
                                </label>
                                <input type="text" name="cedulaConductor" required
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition"
                                       placeholder="1234567890">
                            </div>
                        </div>
                    </div>

                    <!-- Punto de Entrega -->
                    <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class='bx bx-map text-emerald-600'></i>
                            Punto de Entrega
                        </h4>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Dirección Completa de Entrega *
                            </label>
                            <textarea name="puntoEntrega" required rows="3"
                                      class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition resize-none"
                                      placeholder="Ingresa la dirección completa del predio donde se entregará el ganado: Vereda, Finca, Municipio, Departamento..."></textarea>
                            <p class="text-xs text-gray-500 mt-2">Esta es la dirección donde el transportista entregará el ganado</p>
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class='bx bx-note text-gray-600'></i>
                            Observaciones Adicionales
                        </h4>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Indicaciones Especiales (Opcional)
                            </label>
                            <textarea name="observacionesComprador" rows="3"
                                      class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-0 transition resize-none"
                                      placeholder="Ej: El predio tiene acceso por carretera destapada, tener precaución. Contactar con el mayordomo al llegar..."></textarea>
                        </div>
                    </div>

                    <!-- Información Importante -->
                    <div class="bg-amber-50 border-l-4 border-amber-500 p-5 rounded-lg">
                        <div class="flex items-start gap-3">
                            <i class='bx bx-info-circle text-2xl text-amber-600 flex-shrink-0'></i>
                            <div>
                                <p class="font-bold text-amber-900 mb-2">Importante</p>
                                <ul class="text-sm text-amber-800 leading-relaxed space-y-1 list-disc list-inside">
                                    <li>El vendedor será notificado inmediatamente después de programar el transporte</li>
                                    <li>Verifica que todos los datos del conductor y vehículo sean correctos</li>
                                    <li>El vehículo debe estar registrado ante el ICA para transporte de ganado</li>
                                    <li>El conductor debe portar la GSMI vigente el día del transporte</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="flex gap-4">
                        <button type="button" onclick="history.back()"
                                class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class='bx bx-arrow-back'></i> Atrás
                        </button>

                        <button type="submit"
                                class="flex-1 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white rounded-xl font-bold text-lg hover:shadow-2xl hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                            <i class='bx bx-check-circle'></i>
                            Programar Transporte
                            <i class='bx bx-right-arrow-alt'></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- CASO 2: Transporte PROGRAMADO - Esperando carga -->
            <div th:if="${transporte != null && transporte.estadoTransporte.name() == 'PROGRAMADO'}">
                <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-time-five text-2xl text-blue-700'></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-blue-900 text-lg mb-2">Transporte Programado</p>
                            <p class="text-sm text-blue-800 leading-relaxed">
                                El transporte ha sido programado exitosamente. El vendedor ha sido notificado y está preparando el ganado
                                para la fecha programada. Recibirás una notificación cuando el vendedor confirme la carga.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Detalles del Transporte Programado -->
                <div class="bg-white border-2 border-emerald-300 rounded-2xl p-6 mb-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class='bx bx-info-circle text-emerald-600'></i>
                        Detalles del Transporte
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Fecha Programada</p>
                            <p class="font-bold text-gray-900 text-lg" th:text="${#temporals.format(transporte.fechaTransporte, 'dd/MMM/yyyy')}">28/Ene/2025</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Hora Estimada</p>
                            <p class="font-bold text-gray-900 text-lg" th:text="${transporte.horaTransporte}">10:00 AM</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Empresa Transportadora</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.empresaTransporte}">Transportes Los Llanos</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Placa del Vehículo</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.placaVehiculo}">ABC123</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Conductor</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.nombreConductor}">Juan Pérez</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Teléfono Conductor</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.telefonoConductor}">+57 300 123 4567</p>
                        </div>

                        <div class="md:col-span-2 bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Punto de Entrega</p>
                            <p class="font-semibold text-gray-900" th:text="${transporte.puntoEntrega}">Dirección completa...</p>
                        </div>

                        <div th:if="${transporte.observacionesComprador}" class="md:col-span-2 bg-amber-50 rounded-lg p-4 border border-amber-200">
                            <p class="text-xs text-amber-700 mb-1 font-semibold">Observaciones</p>
                            <p class="text-sm text-amber-900" th:text="${transporte.observacionesComprador}">Observaciones...</p>
                        </div>
                    </div>
                </div>

                <!-- Timeline de Estado -->
                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">Estado del Transporte</h4>

                    <div class="relative">
                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>

                        <!-- Paso 1: Programado -->
                        <div class="relative pl-12 pb-8">
                            <div class="absolute left-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class='bx bx-check text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900">Transporte Programado</p>
                                <p class="text-sm text-gray-600">El transporte ha sido programado exitosamente</p>
                            </div>
                        </div>

                        <!-- Paso 2: Esperando carga -->
                        <div class="relative pl-12 pb-8">
                            <div class="absolute left-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center animate-pulse">
                                <i class='bx bx-time text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-blue-900">Esperando Carga</p>
                                <p class="text-sm text-blue-700">El vendedor cargará el ganado en la fecha programada</p>
                            </div>
                        </div>

                        <!-- Paso 3: En camino (pendiente) -->
                        <div class="relative pl-12 pb-8 opacity-40">
                            <div class="absolute left-0 w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                                <i class='bx bx-truck text-gray-600 text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-700">En Camino</p>
                                <p class="text-sm text-gray-500">El ganado será transportado a tu predio</p>
                            </div>
                        </div>

                        <!-- Paso 4: Confirmar recepción (pendiente) -->
                        <div class="relative pl-12 opacity-40">
                            <div class="absolute left-0 w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                                <i class='bx bx-check-double text-gray-600 text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-700">Confirmar Recepción</p>
                                <p class="text-sm text-gray-500">Confirmarás la llegada del ganado</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CASO 3: Transporte EN CAMINO - Esperando confirmación de recepción -->
            <div th:if="${transporte != null && transporte.estadoTransporte.name() == 'EN_CAMINO'}">
                <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0 animate-pulse">
                            <i class='bx bx-truck text-2xl text-blue-700'></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-blue-900 text-lg mb-2">Ganado En Camino</p>
                            <p class="text-sm text-blue-800 leading-relaxed">
                                El vendedor ha confirmado la carga del ganado. El transporte está en camino hacia tu predio.
                                Una vez que el ganado llegue, deberás confirmar la recepción subiendo las fotos correspondientes.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Información de la Carga -->
                <div class="bg-white border-2 border-emerald-300 rounded-2xl p-6 mb-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class='bx bx-package text-emerald-600'></i>
                        Información de la Carga
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
                            <p class="text-xs text-emerald-700 mb-1 font-semibold">Fecha y Hora de Carga</p>
                            <p class="font-bold text-emerald-900" th:text="${#temporals.format(transporte.fechaHoraCarga, 'dd/MMM/yyyy HH:mm')}">28/Ene/2025 10:30</p>
                        </div>

                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <p class="text-xs text-blue-700 mb-1 font-semibold">Estado Actual</p>
                            <p class="font-bold text-blue-900 flex items-center gap-2">
                                <span class="w-2 h-2 bg-blue-600 rounded-full animate-pulse"></span>
                                En Tránsito
                            </p>
                        </div>

                        <div th:if="${transporte.observacionesVendedor}" class="md:col-span-2 bg-amber-50 rounded-lg p-4 border border-amber-200">
                            <p class="text-xs text-amber-700 mb-1 font-semibold">Observaciones del Vendedor</p>
                            <p class="text-sm text-amber-900" th:text="${transporte.observacionesVendedor}">Observaciones...</p>
                        </div>
                    </div>

                    <!-- Fotos de Carga -->
                    <div>
                        <p class="font-bold text-gray-900 mb-3">Fotos de la Carga</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div th:each="archivo : ${transporte.archivosTransporte}"
                                 th:if="${archivo.tipoArchivo.name() == 'CAMION_VACIO' || archivo.tipoArchivo.name() == 'CARGA_GANADO' || archivo.tipoArchivo.name() == 'GSMI_CONDUCTOR'}"
                                 class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="aspect-video bg-gray-200 rounded-lg mb-2 overflow-hidden">
                                    <img th:src="@{'/transporte/' + ${archivo.rutaArchivo}}"
                                         th:alt="${archivo.descripcion}"
                                         class="w-full h-full object-cover cursor-pointer hover:scale-105 transition"
                                         onclick="window.open(this.src, '_blank')">
                                </div>
                                <p class="text-xs text-gray-600 font-semibold" th:text="${archivo.descripcion}">Descripción</p>
                                <p class="text-xs text-gray-500" th:text="${#temporals.format(archivo.fechaSubida, 'dd/MMM HH:mm')}">28/Ene 10:30</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formulario de Confirmación de Recepción -->
                <form th:action="@{/comprador/compras/confirmar-recepcion}" method="post" enctype="multipart/form-data" class="space-y-6">
                    <input type="hidden" name="idTransporte" th:value="${transporte.idTransporte}">

                    <div class="bg-white border-2 border-emerald-300 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class='bx bx-camera text-emerald-600'></i>
                            Confirmar Recepción del Ganado
                        </h4>

                        <p class="text-sm text-gray-600 mb-6">
                            Una vez que el ganado haya llegado a tu predio, debes confirmar la recepción subiendo las siguientes fotos obligatorias:
                        </p>

                        <div class="space-y-5">
                            <!-- Foto 1: Ganado Descargado -->
                            <div class="border-2 border-emerald-200 rounded-xl p-5 bg-emerald-50/30">
                                <label class="block">
                                    <div class="flex items-start gap-3 mb-3">
                                        <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class='bx bx-image text-xl text-emerald-600'></i>
                                        </div>
                                        <div class="flex-1">
                                    <span class="text-sm font-bold text-gray-900 flex items-center gap-2">
                                        Foto del Ganado Descargado *
                                        <span class="text-xs bg-emerald-600 text-white px-2 py-0.5 rounded-full">OBLIGATORIA</span>
                                    </span>
                                            <p class="text-xs text-gray-600 mt-1 leading-relaxed">
                                                Toma una foto del ganado inmediatamente después de descargarlo del camión
                                            </p>
                                        </div>
                                    </div>
                                    <input type="file" name="fotoGanadoDescargado" accept="image/*" capture="environment" required
                                           class="block w-full text-sm text-gray-600 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-emerald-100 file:text-emerald-700 hover:file:bg-emerald-200 cursor-pointer transition">
                                </label>
                            </div>

                            <!-- Foto 2: Ganado en Nuevo Lote -->
                            <div class="border-2 border-emerald-200 rounded-xl p-5 bg-emerald-50/30">
                                <label class="block">
                                    <div class="flex items-start gap-3 mb-3">
                                        <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class='bx bx-image text-xl text-emerald-600'></i>
                                        </div>
                                        <div class="flex-1">
                                    <span class="text-sm font-bold text-gray-900 flex items-center gap-2">
                                        Foto del Ganado en el Nuevo Lote *
                                        <span class="text-xs bg-emerald-600 text-white px-2 py-0.5 rounded-full">OBLIGATORIA</span>
                                    </span>
                                            <p class="text-xs text-gray-600 mt-1 leading-relaxed">
                                                Foto del ganado ya ubicado en su nuevo lote o potrero
                                            </p>
                                        </div>
                                    </div>
                                    <input type="file" name="fotoGanadoNuevoLote" accept="image/*" capture="environment" required
                                           class="block w-full text-sm text-gray-600 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-emerald-100 file:text-emerald-700 hover:file:bg-emerald-200 cursor-pointer transition">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Confirmación Legal -->
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-6">
                        <p class="font-bold text-blue-900 mb-4 flex items-center gap-2 text-lg">
                            <i class='bx bx-shield-alt-2'></i>
                            Declaración de Recepción
                        </p>
                        <div class="space-y-4">
                            <label class="flex items-start gap-3 cursor-pointer hover:bg-blue-100/50 p-3 rounded-lg transition">
                                <input type="checkbox" name="confirmaRecepcion" required
                                       class="mt-1 w-5 h-5 text-blue-600 border-2 border-gray-400 rounded focus:ring-blue-500">
                                <span class="text-sm text-blue-900 leading-relaxed">
                            <strong>Confirmo que he recibido el ganado en las condiciones acordadas.</strong>
                            El ganado ha llegado en buen estado y corresponde a la cantidad y características pactadas.
                        </span>
                            </label>
                            <label class="flex items-start gap-3 cursor-pointer hover:bg-blue-100/50 p-3 rounded-lg transition">
                                <input type="checkbox" name="confirmaEstadoSanitario" required
                                       class="mt-1 w-5 h-5 text-blue-600 border-2 border-gray-400 rounded focus:ring-blue-500">
                                <span class="text-sm text-blue-900 leading-relaxed">
                            <strong>El estado sanitario del ganado es satisfactorio.</strong>
                            He verificado visualmente que los animales se encuentran en buen estado de salud.
                        </span>
                            </label>
                            <label class="flex items-start gap-3 cursor-pointer hover:bg-blue-100/50 p-3 rounded-lg transition">
                                <input type="checkbox" name="confirmaDocumentacion" required
                                       class="mt-1 w-5 h-5 text-blue-600 border-2 border-gray-400 rounded focus:ring-blue-500">
                                <span class="text-sm text-blue-900 leading-relaxed">
                            <strong>Toda la documentación está en orden.</strong>
                            He recibido la GSMI y demás documentos requeridos para la trazabilidad del ganado.
                        </span>
                            </label>
                        </div>
                    </div>

                    <!-- Información Importante -->
                    <div class="bg-amber-50 border-l-4 border-amber-500 p-5 rounded-lg">
                        <div class="flex items-start gap-3">
                            <i class='bx bx-info-circle text-2xl text-amber-600 flex-shrink-0'></i>
                            <div>
                                <p class="font-bold text-amber-900 mb-2">Importante</p>
                                <ul class="text-sm text-amber-800 leading-relaxed space-y-1 list-disc list-inside">
                                    <li>Al confirmar la recepción, la venta se marcará como <strong>FINALIZADA</strong></li>
                                    <li>Esta acción no se puede deshacer</li>
                                    <li>Las fotos quedarán registradas en el sistema para trazabilidad</li>
                                    <li>Tanto tú como el vendedor recibirán un certificado de finalización</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="flex gap-4">
                        <button type="button" onclick="history.back()"
                                class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class='bx bx-arrow-back'></i> Volver
                        </button>

                        <button type="submit"
                                class="flex-1 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white rounded-xl font-bold text-lg hover:shadow-2xl hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                            <i class='bx bx-check-double'></i>
                            Confirmar Recepción y Finalizar Venta
                        </button>
                    </div>
                </form>
            </div>

            <!-- CASO 4: Transporte COMPLETADO - Venta Finalizada -->
            <div th:if="${transporte != null && transporte.estadoTransporte.name() == 'COMPLETADO'}">
                <div class="bg-emerald-50 border-2 border-emerald-300 rounded-xl p-6 mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-emerald-200 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class='bx bx-check-double text-2xl text-emerald-700'></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-emerald-900 text-lg mb-2">¡Venta Finalizada Exitosamente!</p>
                            <p class="text-sm text-emerald-800 leading-relaxed">
                                Has confirmado la recepción del ganado. La venta se ha completado satisfactoriamente y toda la documentación
                                ha sido registrada en el sistema para trazabilidad completa.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Resumen Final del Transporte -->
                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 mb-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class='bx bx-file-blank text-gray-600'></i>
                        Resumen del Transporte
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Fecha de Carga</p>
                            <p class="font-bold text-gray-900" th:text="${#temporals.format(transporte.fechaHoraCarga, 'dd/MMM/yyyy HH:mm')}">28/Ene/2025 10:30</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Fecha de Entrega</p>
                            <p class="font-bold text-gray-900" th:text="${#temporals.format(transporte.fechaHoraEntrega, 'dd/MMM/yyyy HH:mm')}">28/Ene/2025 16:45</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Empresa Transportadora</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.empresaTransporte}">Transportes Los Llanos</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-xs text-gray-600 mb-1">Conductor</p>
                            <p class="font-bold text-gray-900" th:text="${transporte.nombreConductor}">Juan Pérez</p>
                        </div>

                        <div class="md:col-span-2 bg-emerald-50 rounded-lg p-4 border border-emerald-200">
                            <p class="text-xs text-emerald-700 mb-1 font-semibold">Estado Final</p>
                            <p class="font-bold text-emerald-900 flex items-center gap-2">
                                <i class='bx bx-check-circle'></i>
                                Entregado y Confirmado
                            </p>
                        </div>
                    </div>

                    <!-- Galería de Fotos Completa -->
                    <div>
                        <p class="font-bold text-gray-900 mb-3">Documentación Fotográfica</p>

                        <!-- Fotos de Carga -->
                        <div class="mb-4">
                            <p class="text-sm font-semibold text-gray-700 mb-2">Fotos de Carga (Vendedor)</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div th:each="archivo : ${transporte.archivosTransporte}"
                                     th:if="${archivo.tipoArchivo.name() == 'CAMION_VACIO' || archivo.tipoArchivo.name() == 'CARGA_GANADO' || archivo.tipoArchivo.name() == 'GSMI_CONDUCTOR'}"
                                     class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                    <div class="aspect-video bg-gray-200 rounded-lg mb-2 overflow-hidden">
                                        <img th:src="@{'/transporte/' + ${archivo.rutaArchivo}}"
                                             th:alt="${archivo.descripcion}"
                                             class="w-full h-full object-cover cursor-pointer hover:scale-105 transition"
                                             onclick="window.open(this.src, '_blank')">
                                    </div>
                                    <p class="text-xs text-gray-600 font-semibold" th:text="${archivo.descripcion}">Descripción</p>
                                    <p class="text-xs text-gray-500" th:text="${#temporals.format(archivo.fechaSubida, 'dd/MMM HH:mm')}">28/Ene 10:30</p>
                                </div>
                            </div>
                        </div>

                        <!-- Fotos de Entrega -->
                        <div>
                            <p class="text-sm font-semibold text-gray-700 mb-2">Fotos de Entrega (Comprador)</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div th:each="archivo : ${transporte.archivosTransporte}"
                                     th:if="${archivo.tipoArchivo.name() == 'GANADO_DESCARGADO' || archivo.tipoArchivo.name() == 'GANADO_NUEVO_LOTE'}"
                                     class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                    <div class="aspect-video bg-gray-200 rounded-lg mb-2 overflow-hidden">
                                        <img th:src="@{'/transporte/' + ${archivo.rutaArchivo}}"
                                             th:alt="${archivo.descripcion}"
                                             class="w-full h-full object-cover cursor-pointer hover:scale-105 transition"
                                             onclick="window.open(this.src, '_blank')">
                                    </div>
                                    <p class="text-xs text-gray-600 font-semibold" th:text="${archivo.descripcion}">Descripción</p>
                                    <p class="text-xs text-gray-500" th:text="${#temporals.format(archivo.fechaSubida, 'dd/MMM HH:mm')}">28/Ene 16:45</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timeline Completo -->
                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">Historial del Transporte</h4>

                    <div class="relative">
                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-emerald-300"></div>

                        <!-- Paso 1: Programado -->
                        <div class="relative pl-12 pb-8">
                            <div class="absolute left-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class='bx bx-check text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900">Transporte Programado</p>
                                <p class="text-sm text-gray-600" th:text="${#temporals.format(transporte.fechaTransporte, 'dd/MMM/yyyy')}">28/Ene/2025</p>
                            </div>
                        </div>

                        <!-- Paso 2: Carga -->
                        <div class="relative pl-12 pb-8">
                            <div class="absolute left-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class='bx bx-check text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900">Carga Confirmada</p>
                                <p class="text-sm text-gray-600" th:text="${#temporals.format(transporte.fechaHoraCarga, 'dd/MMM/yyyy HH:mm')}">28/Ene/2025 10:30</p>
                            </div>
                        </div>

                        <!-- Paso 3: En camino -->
                        <div class="relative pl-12 pb-8">
                            <div class="absolute left-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class='bx bx-check text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900">En Tránsito</p>
                                <p class="text-sm text-gray-600">Ganado transportado exitosamente</p>
                            </div>
                        </div>

                        <!-- Paso 4: Completado -->
                        <div class="relative pl-12">
                            <div class="absolute left-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class='bx bx-check-double text-white text-lg'></i>
                            </div>
                            <div>
                                <p class="font-bold text-emerald-900">Recepción Confirmada</p>
                                <p class="text-sm text-emerald-700" th:text="${#temporals.format(transporte.fechaHoraEntrega, 'dd/MMM/yyyy HH:mm')}">28/Ene/2025 16:45</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${venta.estado.name() == 'FINALIZADA'}"
                     class="bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-300 rounded-2xl p-7 mt-8 shadow-sm">

                    <div class="text-center">

                        <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-5 shadow-inner">
                            <i class='bx bx-check-circle text-4xl text-emerald-700'></i>
                        </div>

                        <p class="font-bold text-emerald-900 text-2xl mb-2">
                            ¡Compra Finalizada Exitosamente!
                        </p>

                        <p class="text-emerald-800 text-sm mb-5 max-w-xl mx-auto">
                            Esta compra ha sido procesada completamente. Ya puedes consultar toda la información
                            relacionada con el producto, documentos, comprobantes y trazabilidad.
                        </p>

                        <div class="bg-white/80 rounded-xl p-5 border border-emerald-200 shadow-sm max-w-md mx-auto">

                            <p class="text-emerald-900 text-sm font-semibold mb-2 flex items-center justify-center gap-2">
                                <i class='bx bx-info-circle text-emerald-600 text-lg'></i>
                                ¿Quieres revisar los detalles completos?
                            </p>

                            <p class="text-emerald-700 text-xs mb-4">
                                Puedes acceder nuevamente a toda la información de esta compra desde tu panel de compras.
                            </p>

                            <a href="/comprador/compras"
                               class="inline-block mt-2 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold px-4 py-2 rounded-lg shadow">
                                Ir al Panel de Compras
                            </a>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>