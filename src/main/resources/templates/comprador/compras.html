<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">
<head>
    <title>Panel de Compras | Terranova</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .card-hover {
            transition: all 0.4s ease;
        }
        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-en-proceso {
            background-color: #f59e0b;
        }
        .status-finalizada {
            background-color: #10b981;
        }
        .file-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Gradientes profesionales */
        .floating-animation {
        animation: float 6s ease-in-out infinite;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .compra-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .section-card {
            background: linear-gradient(145deg, #ffffff 0%, #f1f5f9 100%);
            border: 1px solid rgba(148, 163, 184, 0.15);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .accent-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .accent-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .accent-red{
            background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%);
        }

        .accent-yellow {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
        }

        .text-gradient {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-hero {
            background: linear-gradient(135deg, #064e3b 0%, #059669 50%, #10b981 100%);
        }
        .fondo-card {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

    </style>
</head>
<body class="bg-gray-50">

<div class=" min-h-screen">
    <!-- Changed navbar to buyer navbar -->
    <div th:replace="fragments/comprador/navbarComprador :: navbarComprador"></div>

    <div class="ml-64 flex flex-col min-h-screen">
        <main class="w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Updated header for buyer's purchase panel -->
            <div class="gradient-hero rounded-3xl p-8 mb-8 text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-black/10"></div>
                <div class="relative z-10">
                    <h1 class="text-4xl font-bold mb-3">Mis Compras</h1>
                    <p class="text-emerald-100 text-lg">Gestiona tus compras manera eficiente</p>
                </div>
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full"></div>
                <div class="absolute -bottom-5 -left-5 w-32 h-32 bg-white/5 rounded-full"></div>
            </div>

            <div class="space-y-4">
                <div th:each="compra : ${compras}">

                    <div id="modalFinalizar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 invisible transition-opacity duration-300 z-50">
                        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-lg transform transition-transform duration-300 scale-95">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Finalizar Venta</h3>
                            <p class="text-gray-600 mb-6">¿Deseas marcar esta venta como finalizada?</p>
                            <div class="flex justify-end gap-3">
                                <button onclick="closeModal('modalFinalizar')" class="px-4 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Cerrar</button>
                                <form th:action="@{/comprador/compras/actualizar-compra}" method="post">
                                    <input type="hidden" name="idVenta" th:value="${compra.idVenta}">
                                    <input type="hidden" name="accion" value="finalizar">
                                    <button type="submit" class="px-4 py-2 rounded-xl bg-green-600 text-white hover:bg-green-700">Finalizar</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div id="modalCancelar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 invisible transition-opacity duration-300 z-50">
                        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-lg transform transition-transform duration-300 scale-95">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Cancelar Venta</h3>
                            <p class="text-gray-600 mb-6">¿Deseas marcar esta venta como cancelada?</p>
                            <div class="flex justify-end gap-3">
                                <button onclick="closeModal('modalCancelar')" class="px-4 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Cerrar</button>
                                <form th:action="@{/comprador/compras/actualizar-compra}" method="post">
                                    <input type="hidden" name="idVenta" th:value="${compra.idVenta}">
                                    <input type="hidden" name="accion" value="cancelar">
                                    <button type="submit" class="px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700">Cancelar</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="card-hover compra-card rounded-xl shadow-lg overflow-hidden">
                        <!-- Header compacto -->
                        <div class="px-6 py-3 fondo-card border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center shadow-md">
                                        <div th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Ganado)}"><i class="fas fa-cow text-green-600 text-sm"></i></div>
                                        <div th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Terreno)}"><i class="fas fa-mountain text-green-600 text-sm"></i></div>
                                        <div th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Finca)}"><i class="fas fa-house text-green-600 text-sm"></i></div>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white" th:text="${compra.producto.nombreProducto}">NombreProducto</h3>
                                        <p class="text-xs text-white" th:text="'ID: ' + ${compra.idVenta} + ' • ' + 'Iniciado el ' + ${compra.fechaInicioVenta}"></p>
                                    </div>
                                </div>
                                <div class="flex items-center bg-white px-3 py-1 rounded-full shadow-sm">
                                    <div th:switch="${compra.estado}">
                                        <span th:case="'Finalizada'" class="status-dot status-finalizada"></span>
                                        <span th:case="'Cancelada'" class="status-dot bg-red-500"></span>
                                        <span th:case="'En Proceso'" class="status-dot status-en-proceso"></span>
                                        <span th:case="'Pendiente Confirmacion'" class="status-dot bg-blue-500"></span>
                                    </div>
                                    <span class="text-xs font-semibold text-gray-700" th:text="${compra.estado}"></span>
                                </div>
                            </div>
                        </div>

                        <div class="p-5">
                            <!-- Layout Principal: Single Column with Horizontal Sections -->
                            <div th:classappend="${compra.estado == 'En Proceso' or compra.estado == 'Pendiente Confirmacion' ? 'opacity-100' : 'opacity-75'}" class="space-y-4">

                                <!-- FILA SUPERIOR: Producto y Vendedor lado a lado -->
                                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
                                    <!-- Producto -->
                                    <div class="section-card rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                            <div class="w-6 h-6 accent-green rounded-md flex items-center justify-center mr-2">
                                                <i class="fas fa-box text-white text-xs"></i>
                                            </div>
                                            Producto
                                        </h4>
                                        <div class="space-y-2">
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Tipo:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Ganado)}">Ganado</span>
                                                <span class="font-medium text-gray-800 text-sm" th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Terreno)}">Terreno</span>
                                                <span class="font-medium text-gray-800 text-sm" th:if="${compra.producto instanceof T(com.proyecto.terranova.entity.Finca)}">Finca</span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Ubicación:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:text="${compra.producto.ciudad.nombreCiudad}"></span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Fecha De Publicacion:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:text="${#strings.capitalize(#temporals.format(compra.producto.fechaPublicacion, 'EEEE d MMMM', T(java.util.Locale).forLanguageTag('es-ES')))}"></span>
                                            </div>
                                            <div class="flex justify-between py-1">
                                                <span class="text-gray-600 text-sm">Detalle del producto: </span>
                                                <span class="font-medium text-blue-600 underline text-sm"><a href="">Ver detalles completos</a></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Vendedor -->
                                    <div class="section-card rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                            <div class="w-6 h-6 accent-green rounded-md flex items-center justify-center mr-2">
                                                <i class="fas fa-user-tie text-white text-xs"></i>
                                            </div>
                                            Vendedor
                                        </h4>
                                        <div class="space-y-2">
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Nombres:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:text="${compra.producto.vendedor.nombres}"></span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Apellidos:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:text="${compra.producto.vendedor.apellidos}"></span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Teléfono:</span>
                                                <span class="font-medium text-gray-800 text-sm" th:text="'+57 ' + ${compra.producto.vendedor.telefono}"></span>
                                            </div>
                                            <div class="flex justify-between py-1">
                                                <span class="text-gray-600 text-sm">Email:</span>
                                                <span class="font-medium text-gray-800 text-xs" th:text="${compra.producto.vendedor.email}"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- FILA INFERIOR: Compra y Comprobantes lado a lado -->
                                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
                                    <!-- Compra -->
                                    <div class="section-card rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                            <div class="w-6 h-6 accent-yellow rounded-md flex items-center justify-center mr-2">
                                                <i class="fas fa-dollar-sign text-white text-xs"></i>
                                            </div>
                                            Compra
                                        </h4>
                                        <div class="space-y-2">
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Precio:</span>
                                                <span class="font-bold text-green-700" th:text="'$' + ${#numbers.formatInteger(compra.producto.precioProducto, 0, 'COMMA')}"></span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Estado:</span>
                                                <span class="font-medium text-yellow-600 text-sm" th:text="${compra.estado}"></span>
                                            </div>
                                            <div class="flex justify-between py-1 border-b border-gray-100">
                                                <span class="text-gray-600 text-sm">Fecha:</span>
                                                <span class="font-medium text-gray-800 text-sm">
                                                    <span th:if="${compra.fechaVenta != null and compra.fechaVenta != ''}" th:text="${#strings.capitalize(#temporals.format(compra.fechaVenta, 'EEEE d MMMM - h:mm a', T(java.util.Locale).forLanguageTag('es-ES')))}"></span>
                                                    <span th:unless="${compra.fechaVenta != null and compra.fechaVenta != ''}">Aún no se ha finalizado la compra</span>
                                                </span>
                                            </div>
                                            <div class="flex justify-between py-1">
                                                <span class="text-gray-600 text-sm">Metodo De Pago:</span>
                                                <span class="font-medium text-gray-800 text-sm">
                                                    <span th:if="${compra.metodoPago != null and compra.metodoPago != ''}" th:text="${compra.metodoPago}"></span>
                                                    <span th:unless="${compra.metodoPago != null and compra.metodoPago != ''}">Aún no se ha finalizado la compra</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Comprobantes -->
                                    <div class="section-card rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                            <div class="w-6 h-6 bg-gradient-to-r from-purple-500 to-purple-600 rounded-md flex items-center justify-center mr-2">
                                                <i class="fas fa-paperclip text-white text-xs"></i>
                                            </div>
                                            <div th:text="'Comprobantes (' + ${compra.listaComprobantes.size()} + ')'"></div>
                                        </h4>
                                        <div class="space-y-2">
                                            <div th:if="${not #lists.isEmpty(compra.listaComprobantes)}">
                                                <div th:each="comprobante : ${compra.listaComprobantes}">
                                                    <a th:href="@{'/archivos/' + ${comprobante.rutaArchivo}}" target="_blank" class="hover:bg-gray-200 cursor-pointer">
                                                        <div class="flex items-center space-x-3 p-2 bg-gradient-to-r from-gray-50 to-gray-100 rounded border border-gray-200">
                                                            <div class="file-icon bg-red-100 text-red-600">
                                                                <i class="fas fa-file-pdf"></i>
                                                            </div>
                                                            <div class="flex-1">
                                                                <p class="font-medium text-gray-800 text-sm" th:text="${comprobante.nombreComprobante}"></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <div th:unless="${not #lists.isEmpty(compra.listaComprobantes)}">
                                                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                                                    <div class="flex">
                                                        <div class="flex-shrink-0">
                                                            <i class="fas fa-info-circle text-blue-400 text-lg"></i>
                                                        </div>
                                                        <div class="ml-3">
                                                            <p class="text-sm text-blue-700 leading-relaxed">
                                                                El vendedor aún no ha subido comprobantes para esta venta.
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Updated action buttons for buyer perspective -->
                            <div th:switch="${compra.estado}">
                                <!-- Caso: Finalizada -->
                                <div th:case="'Finalizada'" class="mt-4 bg-green-50 border-l-4 border-green-400 p-3 rounded">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-check text-green-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-green-700">
                                                Tu compra ha sido finalizada con éxito.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Caso: Cancelada -->
                                <div th:case="'Cancelada'" class="mt-4 bg-red-50 border-l-4 border-red-400 p-3 rounded">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-times text-red-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-red-700">
                                                Esta compra ha sido cancelada.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Caso: En proceso -->
                                <div th:case="'En Proceso'" class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-clock text-yellow-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-yellow-700">
                                                Tu compra está en proceso. El vendedor está preparando la documentación.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Caso: Pendiente Confirmación - Botones de acción -->
                                <div th:case="'Pendiente Confirmacion'">
                                    <div class="mt-4 bg-blue-50 border-l-4 border-blue-400 p-3 rounded mb-4">
                                        <div class="flex">
                                            <div class="flex-shrink-0">
                                                <i class="fas fa-info-circle text-blue-400"></i>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm text-blue-700">
                                                    El vendedor ha solicitado finalizar la venta. Revisa los detalles y confirma si deseas proceder.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                                        <button th:onclick="'openModificarModal(' + ${compra.idVenta} + ')'" type="submit" class="px-4 py-2 accent-yellow hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg font-medium transition-all duration-200 flex items-center shadow-md text-sm">
                                            <i class="fas fa-times mr-1"></i> Pedir Modificacion
                                        </button>

                                        <button onclick="openModal('modalCancelar')" type="submit" class="px-4 py-2 accent-red hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 flex items-center shadow-md text-sm">
                                            <i class="fas fa-times mr-1"></i> Cancelar
                                        </button>

                                        <button onclick="openModal('modalFinalizar')" type="submit" class="px-4 py-2 accent-green hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 flex items-center shadow-md text-sm">
                                            <i class="fas fa-check-circle mr-1"></i> Finalizar Venta
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(compras)}" class="text-center py-12 fade-in">
                <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-calendar-times text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No tienes compras aun</h3>
                <p class="text-gray-600 mb-6">Explora productos, agenda tu cita con un vendedor y si te gusta el producto genera una compra</p>
                <a href="/productos" class="inline-flex items-center px-6 py-3 gradient-bg text-white rounded-xl hover:opacity-90 btn-animate">
                    <i class="fas fa-search mr-2"></i>
                    Explorar Productos
                </a>
            </div>
        </main>
    </div>
</div>

<!-- Modal Modificar -->
<div th:if="${modalModificar}" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-lg transform transition-transform duration-300">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Petición de Modificación Enviada</h3>
        <p class="text-gray-600 mb-6">Tu solicitud de modificación se ha enviado correctamente. El vendedor la revisará pronto.</p>
        <div class="flex justify-end">
            <button onclick="closeConfirmModal(this.closest('div[th\\:if]'))" class="px-4 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Cerrar</button>
        </div>
    </div>
</div>

<div id="modificarModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 invisible transition-opacity duration-300">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-lg transform scale-95 transition-transform duration-300">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800">Pedir Modificación de Compra</h3>
            <button onclick="closeModificarModal()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <form th:action="@{/comprador/compras/actualizar-compra}" method="post" class="space-y-4">
            <input type="hidden" name="idVenta" id="modificarIdVenta">
            <input type="hidden" name="accion" value="modificar">

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Razón de la modificación</label>
                <textarea name="razon" rows="3" required
                          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                          placeholder="Escribe la razón o petición para modificar la compra..."></textarea>
            </div>

            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeModificarModal()" class="px-4 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50">Cerrar</button>
                <button type="submit" class="px-4 py-2 rounded-xl bg-yellow-500 text-white hover:bg-yellow-600">Enviar</button>
            </div>
        </form>
    </div>
</div>

<div th:if="${ventaGenerada}"
     id="modalVentaGenerada"
     class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">

    <!-- Contenido del modal -->
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
        <div class="flex items-center mb-4">
            <svg class="w-8 h-8 text-emerald-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2l4 -4m6 2a9 9 0 11-18 0a9 9 0 0118 0z"/>
            </svg>
            <h3 class="text-lg font-semibold text-gray-900">
                ¡Compra generada con éxito!
            </h3>
        </div>

        <p class="text-gray-600 leading-relaxed">
            Se ha generado una nueva compra. El siguiente paso es que el vendedor complete todos los
            <b>datos obligatorios</b> en el sistema.
        </p>

        <p class="text-gray-600 mt-3 leading-relaxed">
            Una vez el vendedor lo haga, podrá enviar una <b>petición de finalización</b> y
            tú deberás revisar los cambios.
        </p>

        <p class="text-gray-600 mt-3 leading-relaxed">
            Ten en cuenta que este proceso ocurre <b>por fuera de la plataforma</b>, por lo que deberás
            <span class="font-semibold text-emerald-700">ponerte en contacto con el vendedor</span>
            para el papeleo, legalización y demás gestiones.
        </p>

        <div class="mt-6 flex justify-end">
            <button onclick="cerrarModalVenta()"
                    class="px-4 py-2 bg-emerald-600 text-white rounded-lg shadow hover:bg-emerald-700 transition-colors">
                Entendido
            </button>
        </div>
    </div>
</div>

<script>
    function cerrarModalVenta() {
        const modal = document.getElementById("modalVentaGenerada");
        if (modal) {
            modal.classList.add("hidden");
        }
    }

    function openModal(modalId) {
       const modal = document.getElementById(modalId);
       if (modal) {
           modal.classList.remove('opacity-0', 'invisible');
           modal.classList.add('opacity-100', 'visible');
           modal.querySelector('.transform')?.classList.remove('scale-95');
           modal.querySelector('.transform')?.classList.add('scale-100');
       }
   }

   // Función genérica para cerrar un modal
   function closeModal(modalId) {
       const modal = document.getElementById(modalId);
       if (modal) {
           modal.classList.add('opacity-0', 'invisible');
           modal.classList.remove('opacity-100', 'visible');
           modal.querySelector('.transform')?.classList.add('scale-95');
           modal.querySelector('.transform')?.classList.remove('scale-100');
       }
   }

   // Cerrar modales de confirmación que vienen de Thymeleaf
   function closeConfirmModal(modal) {
       modal.classList.add('hidden');
   }

   function openModificarModal(idVenta) {
       document.getElementById('modificarIdVenta').value = idVenta;
       const modal = document.getElementById('modificarModal');
       modal.classList.remove('opacity-0', 'invisible');
       modal.classList.add('opacity-100', 'visible');
       modal.querySelector('.transform').classList.remove('scale-95');
       modal.querySelector('.transform').classList.add('scale-100');
   }

   function closeModificarModal() {
       const modal = document.getElementById('modificarModal');
       modal.classList.add('opacity-0', 'invisible');
       modal.classList.remove('opacity-100', 'visible');
       modal.querySelector('.transform').classList.add('scale-95');
       modal.querySelector('.transform').classList.remove('scale-100');
   }

   function closeConfirmModal() {
       const modal = document.querySelector('[th\\:if="${modalModificar}"]');
       if(modal) modal.classList.add('hidden');
   }

    document.querySelectorAll('[id^="modal"]').forEach(modal => {
        modal.addEventListener('click', e => {
            if (e.target === modal) closeModal(modal.id);
        });
    });

   //LO DEL USER DROPDOWN
   function toggleUserDropdown() {
       const dropdown = document.getElementById('userDropdown');
       const arrow = document.getElementById('dropdownArrow');

       if (dropdown.classList.contains('opacity-0')) {
           dropdown.classList.remove('opacity-0', 'invisible', 'scale-95');
           dropdown.classList.add('opacity-100', 'visible', 'scale-100');
           arrow.style.transform = 'rotate(180deg)';
       } else {
           dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
           dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
           arrow.style.transform = 'rotate(0deg)';
       }
   }

   document.addEventListener('click', function(event) {
       const dropdown = document.getElementById('userDropdown');
       const userButton = event.target.closest('[onclick="toggleUserDropdown()"]');

       if (!userButton && !dropdown.contains(event.target)) {
           dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
           dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
           document.getElementById('dropdownArrow').style.transform = 'rotate(0deg)';
       }
   });
</script>
</body>
</html>
