<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Mi Perfil - Terranova</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#059669',
                        'secondary': '#ffcf00',
                        'primary-dark': '#2d5a2f',
                        'secondary-dark': '#b8860b'
                    }
                }
            }
        }
    </script>
    <style>
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .gradient-hero {
            background: linear-gradient(135deg, #064e3b 0%, #059669 50%, #10b981 100%);
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-active {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            transform: scale(1.1);
        }

        .step-inactive {
            background: #e5e7eb;
            color: #9ca3af;
        }

        .step-completed {
            background: #10b981;
            color: white;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content {
            animation: slideUp 0.3s ease;
        }

        .benefit-card {
            transition: all 0.3s ease;
        }

        .benefit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(5, 150, 105, 0.15);
        }

        .plan-card {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .plan-card.featured {
            border-color: #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%);
        }

        .plan-card:hover {
            box-shadow: 0 20px 40px rgba(5, 150, 105, 0.1);
        }

        .feature-check {
            color: #10b981;
        }

        .upload-zone {
            border: 2px dashed #059669;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            background: rgba(5, 150, 105, 0.05);
            border-color: #10b981;
        }

        .upload-zone.dragover {
            background: rgba(5, 150, 105, 0.1);
            border-color: #10b981;
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gray-50">
<div th:if="${lugar.equals('comprador')}">
    <div th:replace="fragments/comprador/navbarComprador :: navbarComprador"></div>
</div>
<div th:if="${lugar.equals('vendedor')}">
    <div th:replace="fragments/vendedor/navbarVendedor :: navbarVendedor"></div>
</div>

<div class="ml-64 flex flex-col min-h-screen">
    <main class="py-10 px-8">

        <div class="gradient-hero rounded-3xl p-8 mb-8 text-white flex justify-between items-center relative overflow-hidden">
            <div class="absolute inset-0 bg-black/10"></div>
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full"></div>
            <div class="absolute -bottom-5 -left-5 w-32 h-32 bg-white/5 rounded-full"></div>

            <div class="relative z-10 text-left max-w-xl">
                <h1 class="text-4xl font-bold mb-2">Mi Perfil</h1>
                <p class="text-emerald-100 text-lg">Gestiona tu información personal y configuración de cuenta</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <div class="lg:col-span-3">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Foto de Perfil</h2>
                    <form id="photoForm" th:action="@{/usuarios/mi-perfil/cambiar-foto}" method="post"
                          enctype="multipart/form-data">
                        <div class="flex flex-col items-center">
                            <div class="relative mb-4">
                                <div class="w-32 h-32 bg-primary rounded-full flex items-center justify-center overflow-hidden">
                                    <img id="profileImage" th:if="${usuario.foto != null}"
                                         th:src="@{'/imagenes/' + ${usuario.foto}}" alt="Foto de perfil"
                                         class="w-full h-full object-cover">
                                    <svg id="defaultAvatar" class="w-16 h-16 text-white" fill="none"
                                         stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                            </div>

                            <input type="file" id="photoUpload" name="foto" accept="image/*" class="hidden"
                                   onchange="handlePhotoUpload(event)">
                            <button type="button" onclick="document.getElementById('photoUpload').click()"
                                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                                Cambiar Foto
                            </button>
                            <p class="text-xs text-gray-500 mt-2 text-center">JPG, PNG o GIF. Máximo 5MB.</p>
                        </div>
                    </form>
                </div>

                <!-- New seller verification flow with modals -->
                <div th:if="${!esVendedor}"
                     class="bg-gradient-to-br from-[#388e3c] to-[#2d5a2f] rounded-2xl shadow-sm p-6 mt-6 text-white">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">¿Quieres vender?</h3>
                        <p class="text-white/90 text-sm mb-4">Conviértete en vendedor y publica tus propiedades, ganado
                            y terrenos</p>
                        <button onclick="openSellerInfoModal()"
                                class="bg-secondary hover:bg-secondary-dark text-gray-800 font-semibold px-4 py-2 rounded-lg transition-colors w-full">
                            Ser Vendedor
                        </button>
                    </div>
                </div>

                <!-- Existing seller card -->
                <div th:if="${esVendedor}"
                     class="bg-gradient-to-br from-[#388e3c] to-[#2d5a2f] rounded-2xl shadow-sm p-6 mt-6 text-white">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M3 9l1-4h16l1 4M4 9v10a2 2 0 002 2h12a2 2 0 002-2V9M9 22V12h6v10"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">¡Ya eres vendedor!</h3>
                        <p class="text-white/90 text-sm mb-4">
                            Administra tus publicaciones y controla tu actividad desde el Panel Vendedor
                        </p>
                        <a th:href="@{/vendedor/dashboard}"
                           class="bg-secondary hover:bg-secondary-dark text-gray-800 font-semibold px-4 py-2 rounded-lg transition-colors w-full inline-block text-center">
                            Ir al Panel Vendedor
                        </a>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-6">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold text-gray-900">Información Personal</h2>
                        <button id="editButton" onclick="toggleEdit()"
                                class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                            Editar
                        </button>
                    </div>

                    <form th:action="@{/usuarios/mi-perfil/editar}" method="post" th:object="${usuario}"
                          id="profileForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nombres"
                                       class="block text-sm font-medium text-gray-700 mb-2">Nombres</label>
                                <input type="text" id="nombres" th:field="*{nombres}" maxlength="45" disabled
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500">
                            </div>

                            <div>
                                <label for="apellidos"
                                       class="block text-sm font-medium text-gray-700 mb-2">Apellidos</label>
                                <input type="text" id="apellidos" th:field="*{apellidos}" maxlength="45" disabled
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500">
                            </div>
                        </div>

                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Correo
                                Electrónico</label>
                            <input type="email" id="email" th:field="*{email}" disabled
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="telefono"
                                       class="block text-sm font-medium text-gray-700 mb-2">Teléfono</label>
                                <input type="tel" id="telefono" th:field="*{telefono}" maxlength="10" disabled
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500">
                            </div>

                            <div>
                                <label for="nacimiento" class="block text-sm font-medium text-gray-700 mb-2">Fecha de
                                    Nacimiento</label>
                                <input type="date" id="nacimiento" th:field="*{nacimiento}" disabled
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500">
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Información de Cuenta</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <span class="font-medium">Fecha de Registro:</span>
                                    <span class="ml-2" th:text="${fechaRegistro}"></span>
                                </div>
                                <div>
                                    <span class="font-medium">Tipo de Usuario:</span>
                                    <span class="ml-2 bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs"
                                          th:each="rol : ${usuario.roles}" th:text="${rol.nombreRol}"></span>
                                </div>
                            </div>
                        </div>

                        <div id="actionButtons" class="flex justify-end space-x-3 hidden">
                            <button type="button" onclick="cancelEdit()"
                                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors font-medium">
                                Cancelar
                            </button>
                            <button type="submit"
                                    class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg transition-colors font-medium">
                                Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mt-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Seguridad</h2>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900">Contraseña</h3>
                                <p class="text-sm text-gray-600">Última actualización: hace 3 meses</p>
                            </div>
                            <button class="text-primary hover:text-primary-dark font-medium text-sm">
                                Cambiar
                            </button>
                        </div>

                        <div class="flex justify-between items-center py-3">
                            <div>
                                <h3 class="font-medium text-gray-900">Autenticación de dos factores</h3>
                                <p class="text-sm text-gray-600">Agrega una capa extra de seguridad</p>
                            </div>
                            <button class="text-primary hover:text-primary-dark font-medium text-sm">
                                Configurar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Configuración de Notificaciones</h2>

                    <form th:action="@{/usuarios/mi-perfil/notificaciones}" method="post" class="space-y-4">

                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900">Notificaciones por Email</h3>
                                <p class="text-sm text-gray-600">Recibe un correo cuando haya actividad importante</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="emailNotif" th:checked="${usuario.recibirCorreos}"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900"
                                    th:text="${esVendedor} ? 'Ventas' : 'Compras'"></h3>
                                <p class="text-sm text-gray-600">Alertas sobre tus <span
                                        th:text="${esVendedor} ? 'ventas' : 'compras'"></span></p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="ventasCompras" th:checked="${usuario.notificacionesVentas}"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900">Citas</h3>
                                <p class="text-sm text-gray-600">Notificaciones sobre confirmaciones y recordatorios de
                                    citas</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="citas" th:checked="${usuario.notificacionesCitas}"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div th:if="${esVendedor}"
                             class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900">Disponibilidades</h3>
                                <p class="text-sm text-gray-600">Cuando un comprador reserva o interactúa con tus
                                    horarios</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="disponibilidades"
                                       th:checked="${usuario.notificacionesDisponibilidades}" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <h3 class="font-medium text-gray-900">Sistema</h3>
                                <p class="text-sm text-gray-600">Avisos importantes de la plataforma y de cambios en tu
                                    perfil</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="sistema" th:checked="${usuario.notificacionesSistema}"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div th:if="${esVendedor}" class="flex justify-between items-center py-3">
                            <div>
                                <h3 class="font-medium text-gray-900">Productos</h3>
                                <p class="text-sm text-gray-600">Novedades y estado de tus publicaciones</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="productos" th:checked="${usuario.notificacionesProductos}"
                                       class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-primary transition"></div>
                                <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition peer-checked:translate-x-full"></div>
                            </label>
                        </div>

                        <div class="flex justify-end pt-4">
                            <button type="submit"
                                    class="gradient-bg text-white px-6 py-2 rounded-lg font-medium hover:opacity-90 transition">
                                Guardar Preferencias
                            </button>
                        </div>
                    </form>
                </div>

                <!-- New verification benefits card for existing sellers -->
                <div th:if="${esVendedor}" class="mt-6">
                    <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl shadow-sm border-2 border-secondary p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class='bx bx-badge-check text-secondary text-xl'></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900">Obtén tu Verificación Premium</h3>
                                <p class="text-sm text-gray-600 mt-1">Aumenta la confianza de tus compradores y accede a
                                    funciones exclusivas</p>
                            </div>
                        </div>
                        <button onclick="openVerificationPlansModal()"
                                class="w-full bg-gradient-to-r from-primary to-emerald-600 hover:shadow-lg text-white font-semibold py-3 rounded-lg transition-all">
                            Ver Planes de Verificación
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Seller Information & Benefits -->
        <div id="sellerInfoModal" class="modal-overlay">
            <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-primary via-emerald-600 to-primary text-white p-8 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-8 -mb-8"></div>

                    <button onclick="closeSellerInfoModal()"
                            class="absolute top-6 right-6 text-white hover:bg-white/20 p-2 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>

                    <div class="relative z-10">
                        <h2 class="text-3xl font-bold mb-2">¡Bienvenido a Terranova Vendedores!</h2>
                        <p class="text-emerald-100 text-lg">Descubre todo lo que puedes lograr como vendedor
                            verificado</p>
                    </div>
                </div>

                <div class="p-8">
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Beneficios de ser Vendedor</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="benefit-card bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                <div class="flex gap-3">
                                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Publica Anuncios</h4>
                                        <p class="text-sm text-gray-600">Crea hasta 50 anuncios sin límite de
                                            descripción</p>
                                    </div>
                                </div>
                            </div>

                            <div class="benefit-card bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                <div class="flex gap-3">
                                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Gestiona Citas</h4>
                                        <p class="text-sm text-gray-600">Programa y administra reuniones con
                                            compradores</p>
                                    </div>
                                </div>
                            </div>

                            <div class="benefit-card bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                <div class="flex gap-3">
                                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Acceso Completo</h4>
                                        <p class="text-sm text-gray-600">Panel de control exclusivo para vendedores</p>
                                    </div>
                                </div>
                            </div>

                            <div class="benefit-card bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                <div class="flex gap-3">
                                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Estadísticas</h4>
                                        <p class="text-sm text-gray-600">Análisis detallado de tus anuncios y
                                            vendidas</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-lg mb-8">
                        <h4 class="font-semibold text-gray-900 mb-3">Requisitos para Verificación</h4>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li class="flex gap-2">
                                <span class="text-orange-400 font-bold">1.</span>
                                <span>Verificar tu correo electrónico con código de confirmación</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="text-orange-400 font-bold">2.</span>
                                <span>Validar tu cédula mediante OCR (extracción automática de datos)</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="text-orange-400 font-bold">3.</span>
                                <span>Capturar una foto de tu rostro para registro facial</span>
                            </li>
                        </ul>
                    </div>

                    <div class="flex gap-3">
                        <button onclick="closeSellerInfoModal()"
                                class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 rounded-lg transition">
                            Más Tarde
                        </button>
                        <form th:action="@{/comprador/codigo-Verificacion}" method="post">
                            <button type="submit"
                                    class="flex-1 bg-gradient-to-r from-primary to-emerald-600 hover:shadow-lg text-white font-semibold py-3 rounded-lg transition-all">
                                Comenzar Verificación
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Verification Steps -->
        <div id="verificationStepModal" th:if="${mostrarModal}" class="modal-overlay active">
            <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full mx-4 modal-content">
                <div class="bg-gradient-to-r from-primary via-emerald-600 to-primary text-white p-8">
                    <button onclick="closeVerificationStepModal()"
                            class="absolute top-6 right-6 text-white hover:bg-white/20 p-2 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <h2 class="text-3xl font-bold">Proceso de Verificación</h2>
                    <p class="text-emerald-100 mt-2">Completa los pasos para activar tu cuenta de vendedor</p>
                </div>

                <div class="p-8">
                    <!-- Step indicator -->
                    <div class="flex justify-between mb-8">
                        <div class="flex flex-col items-center flex-1">
                            <div class="step-circle step-active" id="step1Circle">1</div>
                            <p class="text-xs font-medium text-gray-600 mt-2 text-center">Correo</p>
                        </div>
                        <div class="flex-1 flex items-start justify-center pt-5">
                            <div class="w-full h-1 bg-gray-200"></div>
                        </div>

                        <div class="flex flex-col items-center flex-1">
                            <div class="step-circle step-inactive" id="step2Circle">2</div>
                            <p class="text-xs font-medium text-gray-600 mt-2 text-center">Cédula</p>
                        </div>
                        <div class="flex-1 flex items-start justify-center pt-5">
                            <div class="w-full h-1 bg-gray-200"></div>
                        </div>

                        <div class="flex flex-col items-center flex-1">
                            <div class="step-circle step-inactive" id="step3Circle">3</div>
                            <p class="text-xs font-medium text-gray-600 mt-2 text-center">Foto</p>
                        </div>
                    </div>

                    <!-- Step 1: Email Verification -->
                    <div id="step1Content" class="step-content">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Verifica tu Correo</h3>
                            <p class="text-gray-600">Enviaremos un código de verificación a tu email registrado</p>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                            <p class="text-sm text-gray-700" th:text="${emailV}"><span
                                    class="font-semibold">Email:</span></p>
                        </div>

                        <div class="mb-6">
                            <!--                            aqui va el form-->
                            <label class="block text-sm font-medium text-gray-700 mb-2">Código de Verificación</label>
                            <input  type="text" placeholder="000000" maxlength="6" id="verificationCode"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-center text-lg tracking-widest">
                            <p id="errorMsg" class="text-red-600 mt-2"></p>
                        </div>

                        <button type="button" onclick="validarCodigo()"
                                class="w-full bg-gradient-to-r from-primary to-emerald-600 text-white font-semibold py-3 rounded-lg hover:shadow-lg transition-all">
                            Verificar Correo
                        </button>
                    </div>

                    <!-- Step 2: ID/Cédula Upload -->
                    <div id="step2Content" class="step-content hidden">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Sube tu Cédula</h3>
                            <p class="text-gray-600">Captura clara de ambos lados. OCR validará automáticamente tus
                                datos</p>
                        </div>

                        <div class="upload-zone" id="cedolaUploadZone" ondrop="handleDrop(event, 'cedula')"
                             ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <svg class="w-12 h-12 text-primary mx-auto mb-3" fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M12 4v16m8-8H4"/>
                            </svg>
                            <p class="text-sm font-semibold text-gray-900 mb-1">Arrastra tu cédula aquí</p>
                            <p class="text-xs text-gray-600 mb-3">o</p>
                            <button type="button" onclick="document.getElementById('cedulaInput').click()"
                                    class="text-primary hover:text-emerald-700 font-semibold text-sm">
                                Seleccionar archivo
                            </button>
                            <input type="file" id="cedulaInput" accept="image/*" class="hidden"
                                   onchange="handleFileSelect(event, 'cedula')">
                            <p class="text-xs text-gray-500 mt-3">JPG, PNG. Máximo 10MB</p>
                        </div>

                        <div id="cedulaPreview" class="mt-6 hidden">
                            <img id="cedulaImage" src="/placeholder.svg" alt="Cédula"
                                 class="w-full rounded-lg border border-gray-200">
                            <button type="button" onclick="removeCedula()"
                                    class="mt-3 text-red-600 hover:text-red-700 font-medium text-sm">
                                Cambiar archivo
                            </button>
                        </div>

                        <div id="ocrResults" class="mt-6 bg-green-50 border border-green-200 rounded-lg p-4 hidden">
                            <h4 class="font-semibold text-gray-900 mb-3">Datos Validados</h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <p class="text-gray-600">Nombres</p>
                                    <p class="font-semibold text-gray-900" id="ocrNombre">Juan Carlos</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Apellidos</p>
                                    <p class="font-semibold text-gray-900" id="ocrApellido">García López</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Cédula</p>
                                    <p class="font-semibold text-gray-900" id="ocrCedula">1234567890</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Fecha de Nacimiento</p>
                                    <p class="font-semibold text-gray-900" id="ocrFecha">01/01/1990</p>
                                </div>
                            </div>
                        </div>

                        <button onclick="nextStep()" id="step2Button"
                                class="w-full mt-6 bg-gray-300 text-gray-500 font-semibold py-3 rounded-lg cursor-not-allowed"
                                disabled>
                            Sube un archivo para continuar
                        </button>
                    </div>

                    <!-- Step 3: Facial Recognition -->
                    <div id="step3Content" class="step-content hidden">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Captura tu Foto</h3>
                            <p class="text-gray-600">Tomaremos una foto de tu rostro para el registro de
                                verificación</p>
                        </div>

                        <div class="bg-gray-900 rounded-2xl overflow-hidden mb-6 relative">
                            <video id="cameraFeed" class="w-full aspect-square object-cover hidden" autoplay
                                   playsinline></video>
                            <div id="cameraPlaceholder"
                                 class="w-full aspect-square bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center">
                                <svg class="w-20 h-20 text-gray-600" fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <canvas id="photoCanvas" class="hidden"></canvas>
                        </div>

                        <div id="photoCapture" class="flex gap-3 mb-6">
                            <button type="button" onclick="startCamera()" id="startCameraBtn"
                                    class="flex-1 bg-primary text-white font-semibold py-3 rounded-lg hover:bg-primary-dark transition">
                                Iniciar Cámara
                            </button>
                            <button type="button" onclick="capturePhoto()" id="captureBtn"
                                    class="flex-1 bg-secondary text-gray-800 font-semibold py-3 rounded-lg hover:bg-secondary-dark transition hidden">
                                Capturar Foto
                            </button>
                        </div>

                        <div id="photoPreview" class="hidden mb-6">
                            <img id="capturedPhoto" src="/placeholder.svg" alt="Foto capturada"
                                 class="w-full rounded-lg border border-gray-200">
                            <div class="flex gap-3 mt-3">
                                <button type="button" onclick="retakePhoto()"
                                        class="flex-1 bg-gray-200 text-gray-800 font-semibold py-2 rounded-lg hover:bg-gray-300 transition">
                                    Retomar Foto
                                </button>
                                <button type="button" onclick="usePhoto()"
                                        class="flex-1 bg-green-600 text-white font-semibold py-2 rounded-lg hover:bg-green-700 transition">
                                    Usar Esta Foto
                                </button>
                            </div>
                        </div>

                        <button onclick="completeVerification()" id="step3Button"
                                class="w-full bg-gray-300 text-gray-500 font-semibold py-3 rounded-lg cursor-not-allowed"
                                disabled>
                            Captura tu foto para finalizar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Verification Plans -->
        <div id="verificationPlansModal" class="modal-overlay">
            <div class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-primary via-emerald-600 to-primary text-white p-8">
                    <button onclick="closeVerificationPlansModal()"
                            class="absolute top-6 right-6 text-white hover:bg-white/20 p-2 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <h2 class="text-3xl font-bold">Planes de Verificación Premium</h2>
                    <p class="text-emerald-100 mt-2">Elige el plan perfecto para tu negocio</p>
                </div>

                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <!-- Basic Plan -->
                        <div class="plan-card rounded-2xl p-6 relative">
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-gray-900">Básico</h3>
                                <p class="text-sm text-gray-600">Para comenzar</p>
                            </div>

                            <div class="mb-4">
                                <span class="text-3xl font-bold text-gray-900">$0</span>
                                <span class="text-gray-600">/mes</span>
                            </div>

                            <ul class="space-y-3 mb-6">
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Hasta 10 anuncios</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Información básica</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-gray-300 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                                    </svg>
                                    <span class="text-sm text-gray-500">Soporte prioritario</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-gray-300 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                                    </svg>
                                    <span class="text-sm text-gray-500">Insignia de verificado</span>
                                </li>
                            </ul>

                            <button class="w-full bg-gray-200 text-gray-800 font-semibold py-2 rounded-lg hover:bg-gray-300 transition">
                                Plan Actual
                            </button>
                        </div>

                        <!-- Professional Plan (Featured) -->
                        <div class="plan-card featured rounded-2xl p-6 relative ring-2 ring-primary">
                            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                <span class="bg-gradient-to-r from-primary to-emerald-600 text-white text-xs font-bold px-4 py-1 rounded-full">
                                    MÁS POPULAR
                                </span>
                            </div>

                            <div class="mb-4 mt-4">
                                <h3 class="text-xl font-bold text-gray-900">Profesional</h3>
                                <p class="text-sm text-gray-600">Para crecer</p>
                            </div>

                            <div class="mb-4">
                                <span class="text-4xl font-bold text-primary">$9,99</span>
                                <span class="text-gray-600">/mes</span>
                            </div>

                            <ul class="space-y-3 mb-6">
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700 font-medium">Hasta 50 anuncios</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700 font-medium">Insignia verificado</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700 font-medium">Soporte prioritario</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700 font-medium">Analytics avanzado</span>
                                </li>
                            </ul>

                            <button class="w-full bg-gradient-to-r from-primary to-emerald-600 text-white font-semibold py-3 rounded-lg hover:shadow-lg transition-all">
                                Suscribirse Ahora
                            </button>
                        </div>

                        <!-- Premium Plan -->
                        <div class="plan-card rounded-2xl p-6 relative">
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-gray-900">Premium</h3>
                                <p class="text-sm text-gray-600">Para expertos</p>
                            </div>

                            <div class="mb-4">
                                <span class="text-3xl font-bold text-gray-900">$24,99</span>
                                <span class="text-gray-600">/mes</span>
                            </div>

                            <ul class="space-y-3 mb-6">
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Anuncios ilimitados</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Insignia premium</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Soporte 24/7</span>
                                </li>
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor"
                                         viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Featured placement</span>
                                </li>
                            </ul>

                            <button class="w-full bg-primary text-white font-semibold py-2 rounded-lg hover:bg-primary-dark transition">
                                Suscribirse Ahora
                            </button>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-700">
                            <span class="font-semibold">Garantía de satisfacción:</span> Cancela en cualquier momento
                            sin penalizaciones
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${vendedorExitoso}"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
             id="vendorConfirmationModal">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">

                <div class="w-20 h-20 bg-gradient-to-r from-[#388e3c] to-[#4caf50] rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">¡Felicidades! 🎉</h2>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    Ya eres vendedor en nuestra plataforma. Ahora puedes acceder a tu panel principal como vendedor
                    desde la opción
                    <span class="font-semibold text-[#388e3c]">"Panel Vendedor"</span> en el menú desplegable.
                </p>

                <div class="flex flex-col sm:flex-row gap-3">
                    <a th:href="@{/vendedor/dashboard}">
                        <button class="flex-1 bg-[#388e3c] text-white px-6 py-3 rounded-xl font-medium hover:bg-[#2e7d32] transition-colors">
                            Ir al Panel Vendedor
                        </button>
                    </a>
                    <button class="flex-1 border border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-50 transition-colors"
                            onclick="closeVendorModal()">
                        Continuar como Comprador
                    </button>
                </div>
            </div>
        </div>
    </main>
</div>
<script>
    let isEditing = false;
    let originalValues = {};

    // Existing functions
    function toggleEdit() {
        const form = document.getElementById('profileForm');
        const editButton = document.getElementById('editButton');
        const actionButtons = document.getElementById('actionButtons');
        const inputs = form.querySelectorAll('input:not([type="file"])');

        if (!isEditing) {
            inputs.forEach(input => {
                originalValues[input.name] = input.value;
            });

            inputs.forEach(input => {
                if (input.name !== 'email') {
                    input.disabled = false;
                    input.classList.remove('disabled:bg-gray-50', 'disabled:text-gray-500');
                }
            });

            editButton.textContent = 'Cancelar';
            editButton.classList.remove('bg-primary', 'hover:bg-primary-dark');
            editButton.classList.add('bg-gray-500', 'hover:bg-gray-600');
            actionButtons.classList.remove('hidden');
            isEditing = true;
        } else {
            cancelEdit();
        }
    }

    function cancelEdit() {
        const form = document.getElementById('profileForm');
        const editButton = document.getElementById('editButton');
        const actionButtons = document.getElementById('actionButtons');
        const inputs = form.querySelectorAll('input:not([type="file"])');

        inputs.forEach(input => {
            if (originalValues[input.name]) {
                input.value = originalValues[input.name];
            }
            input.disabled = true;
            input.classList.add('disabled:bg-gray-50', 'disabled:text-gray-500');
        });

        editButton.textContent = 'Editar';
        editButton.classList.remove('bg-gray-500', 'hover:bg-gray-600');
        editButton.classList.add('bg-primary', 'hover:bg-primary-dark');
        actionButtons.classList.add('hidden');
        isEditing = false;
    }

    function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const profileImage = document.getElementById('profileImage');
                const defaultAvatar = document.getElementById('defaultAvatar');

                profileImage.src = e.target.result;
                profileImage.classList.remove('hidden');
                defaultAvatar.classList.add('hidden');
            };
            reader.readAsDataURL(file);

            document.getElementById('photoForm').submit();
        }
    }

    document.addEventListener('click', function (event) {
        const modals = ['sellerInfoModal', 'verificationStepModal', 'verificationPlansModal'];
        modals.forEach(modalId => {
            const modal = document.getElementById(modalId);
            if (modal && modal.classList.contains('active')) {
                if (!modal.querySelector('.modal-content').contains(event.target) && event.target.id === modalId) {
                    modal.classList.remove('active');
                }
            }
        });
    });

    function closeVendorModal() {
        document.getElementById('vendorConfirmationModal').style.display = 'none';
    }

    function toggleUserDropdown() {
        const dropdown = document.getElementById('userDropdown');
        const arrow = document.getElementById('dropdownArrow');

        if (dropdown.classList.contains('opacity-0')) {
            // Mostrar dropdown
            dropdown.classList.remove('opacity-0', 'invisible', 'scale-95');
            dropdown.classList.add('opacity-100', 'visible', 'scale-100');
            arrow.style.transform = 'rotate(180deg)';
        } else {
            // Ocultar dropdown
            dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
            dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
            arrow.style.transform = 'rotate(0deg)';
        }
    }

    document.addEventListener('click', function (event) {
        const dropdown = document.getElementById('userDropdown');
        const userButton = event.target.closest('[onclick="toggleUserDropdown()"]');

        if (!userButton && !dropdown.contains(event.target)) {
            dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
            dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
            document.getElementById('dropdownArrow').style.transform = 'rotate(0deg)';
        }
    });
</script>

<script>
    let currentStep = 1;
    let photoData = null;
    let cedulaData = null;
    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfHeaderName = document.querySelector('meta[name="_csrf_header"]').content

    // Modal functions
    function openSellerInfoModal() {
        document.getElementById('sellerInfoModal').classList.add('active');
    }

    function closeSellerInfoModal() {
        document.getElementById('sellerInfoModal').classList.remove('active');
    }

    function closeVerificationStepModal() {
        document.getElementById('verificationStepModal').classList.remove('active');
        currentStep = 1;
    }

    function openVerificationPlansModal() {
        document.getElementById('verificationPlansModal').classList.add('active');
    }

    function closeVerificationPlansModal() {
        document.getElementById('verificationPlansModal').classList.remove('active');
    }

    function showStep(stepNum) {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));

        // Show current step
        document.getElementById(`step${stepNum}Content`).classList.remove('hidden');

        // Update circles
        for (let i = 1; i <= 3; i++) {
            const circle = document.getElementById(`step${i}Circle`);
            if (i < stepNum) {
                circle.classList.remove('step-inactive', 'step-active');
                circle.classList.add('step-completed');
            } else if (i === stepNum) {
                circle.classList.remove('step-inactive', 'step-completed');
                circle.classList.add('step-active');
            } else {
                circle.classList.remove('step-active', 'step-completed');
                circle.classList.add('step-inactive');
            }
        }
    }

    function validarCodigo() {
        const codigoInput = document.getElementById("verificationCode").value;

        fetch("/comprador/Vcodigo", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                [csrfHeaderName]: csrfToken   // 👈 aquí va el token CSRF
            },
            body: "codigo=" + encodeURIComponent(codigoInput)
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // ✅ Código correcto: redirigir o cerrar modal
                    console.log("paso en codigo");
                    fetch("/mi-perfil/ser-vendedor", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                            [csrfHeaderName]: csrfToken
                        },
                        body: "" // si tu método no necesita parámetros adicionales
                    })
                        .then(() => {
                            // 👇 después del POST, redirigimos a la vista final
                            window.location.href = "/usuarios/mi-perfil?id=1";
                        });
                } else {
                    // ❌ Error: mostrar mensaje en el modal
                    document.getElementById("errorMsg").innerText = data.error;
                }
            })
            .catch(err => {
                document.getElementById("errorMsg").innerText = "Error en la verificación.";
            });
    }

    function nextStep() {
        if (currentStep < 2) {
            currentStep++;
            showStep(currentStep);
        }
    }

    // Cedula handling
    function handleDrop(e, type) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById(`${type}UploadZone`).classList.remove('dragover');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFileSelect({target: {files}}, type);
        }
    }

    function handleDragOver(e) {
        e.preventDefault();
        document.getElementById('cedolaUploadZone').classList.add('dragover');
    }

    function handleDragLeave(e) {
        if (e.target.id === 'cedolaUploadZone') {
            document.getElementById('cedolaUploadZone').classList.remove('dragover');
        }
    }

    function handleFileSelect(e, type) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                cedulaData = event.target.result;
                document.getElementById(`${type}Image`).src = event.target.result;
                document.getElementById(`${type}Upload` + (type === 'cedula' ? 'Zone' : '')).classList.add('hidden');
                document.getElementById(`${type}Preview`).classList.remove('hidden');

                // Simulate OCR validation
                setTimeout(() => {
                    simulateOCRValidation();
                }, 1000);
            };
            reader.readAsDataURL(file);
        }
    }

    function removeCedula() {
        cedulaData = null;
        document.getElementById('cedulaUploadZone').classList.remove('hidden');
        document.getElementById('cedulaPreview').classList.add('hidden');
        document.getElementById('ocrResults').classList.add('hidden');
        document.getElementById('step2Button').disabled = true;
        document.getElementById('step2Button').classList.add('bg-gray-300', 'cursor-not-allowed');
    }

    function simulateOCRValidation() {
        // Simulate OCR reading
        document.getElementById('ocrResults').classList.remove('hidden');
        document.getElementById('step2Button').disabled = false;
        document.getElementById('step2Button').classList.remove('bg-gray-300', 'cursor-not-allowed');
        document.getElementById('step2Button').classList.add('bg-gradient-to-r', 'from-primary', 'to-emerald-600');
    }

    // Camera functions
    let stream = null;

    function startCamera() {
        navigator.mediaDevices.getUserMedia({video: {facingMode: 'user'}})
            .then(s => {
                stream = s;
                document.getElementById('cameraFeed').srcObject = stream;
                document.getElementById('cameraFeed').classList.remove('hidden');
                document.getElementById('cameraPlaceholder').classList.add('hidden');
                document.getElementById('startCameraBtn').classList.add('hidden');
                document.getElementById('captureBtn').classList.remove('hidden');
            })
            .catch(err => {
                alert('No se pudo acceder a la cámara: ' + err.message);
            });
    }

    function capturePhoto() {
        const video = document.getElementById('cameraFeed');
        const canvas = document.getElementById('photoCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);

        photoData = canvas.toDataURL('image/jpeg');
        document.getElementById('capturedPhoto').src = photoData;
        document.getElementById('photoPreview').classList.remove('hidden');
        document.getElementById('photoCapture').classList.add('hidden');
    }

    function retakePhoto() {
        photoData = null;
        document.getElementById('photoPreview').classList.add('hidden');
        document.getElementById('photoCapture').classList.remove('hidden');
        document.getElementById('step3Button').disabled = true;
    }

    function usePhoto() {
        document.getElementById('step3Button').disabled = false;
        document.getElementById('step3Button').classList.remove('bg-gray-300', 'cursor-not-allowed');
        document.getElementById('step3Button').classList.add('bg-gradient-to-r', 'from-primary', 'to-emerald-600');
    }

    function completeVerification() {
        // Here you would submit the verification data to your backend
        alert('¡Verificación completada! Tu cuenta será revisada en las próximas 24 horas.');
        closeVerificationStepModal();

        // Simulate server response - redirect to dashboard
        setTimeout(() => {
            window.location.href = '/vendedor/dashboard';
        }, 2000);
    }
</script>
</body>
</html>
